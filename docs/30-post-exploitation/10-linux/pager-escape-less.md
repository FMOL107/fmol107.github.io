---
title: Privesc por pagers en Linux
description: Cómo escalar privilegios abusando de pagers (less) cuando se ejecutan vía sudo, incluyendo el caso típico con systemctl status.
tags:
  - linux
  - privesc
  - sudo
  - less
  - pager-escape
  - systemctl
sidebar_position: 20
---

# Escalada de privilegios en Linux: el peligro de `less` y otros pagers

En Linux, **sudo** permite ejecutar comandos con privilegios elevados. El problema aparece cuando se permite ejecutar (directa o indirectamente) software **interactivo** como el paginador **`less`**: muchos de estos programas incorporan funciones para **ejecutar comandos del sistema**, y si se lanzan con sudo, esos comandos se ejecutan como **root**.

> Idea clave: si un *pager* interactivo se ejecuta con privilegios elevados y permite **ejecutar comandos**, un simple escape puede convertirse en una **shell root**.

---

## Cuándo funciona (y cuándo no)

- **Funciona cuando** el comando permitido por sudo abre un *pager* interactivo (habitualmente `less`) y este permite ejecutar comandos (por ejemplo, con `!`).
- **Puede no funcionar si** el pager está deshabilitado, se fuerza salida directa (por ejemplo `cat`), no hay TTY, o el output no dispara el uso de pager.

---

## 1) Identificación del vector

El primer paso es enumerar qué puede ejecutar el usuario actual con sudo:

```bash
sudo -l
```

Señales típicas de riesgo:

* Aparece **`less`** explícitamente como comando permitido.
* Aparecen comandos que suelen invocar un **pager** (por ejemplo, `systemctl status`, `journalctl`, etc.), ya que pueden terminar abriendo `less` y heredar sus escapes.

Checklist rápida:

* `sudo -l`
* ¿El binario permitido puede abrir un pager?
* ¿Qué pager se está usando (`less`, `more`, etc.)?
* ¿Dentro del pager existe escape a comandos (por ejemplo `!`)?

---

## 2) Método directo: escape de shell en `less`

Si tu usuario puede ejecutar `less` con sudo, puedes abrir cualquier archivo y luego “escapar” a una shell:

1. Ejecuta `less` como root:

   ```bash
   sudo less /etc/profile
   ```

2. Dentro de `less`, ejecuta una shell con:

   ```text
   !/bin/sh
   ```

   o:

   ```text
   !/bin/bash
   ```

Esto abre una shell que **hereda los privilegios** del proceso lanzado con sudo.

### Lectura de archivos sensibles (sin llegar a shell)

Incluso sin buscar una shell, `less` puede servir para **leer** ficheros restringidos (por ejemplo `/etc/shadow`) si el proceso corre como root. Además, puede abrir otros archivos desde dentro usando:

```text
:e /ruta/al/archivo
```

Este patrón también está recogido en GTFOBins.

---

## 3) Comandos que suelen terminar en pager

Dependiendo de la distro y configuración, es común ver pagers en comandos como:

* `systemctl` / `journalctl`
* `man`
* `git` (logs, diffs)
* `apt` (changelogs / paginación)

> Nota: no siempre se abrirá pager; puede depender del tamaño del output y del contexto de terminal.

---

## 4) Caso práctico: privesc a través de `systemctl status`

Un caso muy común en CTFs y entornos mal configurados es permitir:

```bash
sudo systemctl status <servicio>
```

Cuando `systemctl status` muestra suficiente salida, suele abrir un **pager** (habitualmente `less`). En ese contexto, puedes aplicar el mismo escape:

1. Ejecuta:

   ```bash
   sudo systemctl status trail.service
   ```

2. Dentro del pager:

   ```text
   !/bin/sh
   ```

Esta técnica y variantes relacionadas con `systemctl` están documentadas en GTFOBins y en guías de privesc por sudo.

---

## 5) Mitigación (lo esencial)

Medidas mínimas efectivas:

* **No permitir** por sudo binarios interactivos con escapes (ej.: `less`, `vi`, `more`, etc.).
* Evitar `NOPASSWD` salvo necesidad real y con comandos **muy acotados** (argumentos fijos, rutas fijas, sin wildcards).
* Revisar listas de sudo periódicamente (`sudoers`/`sudo -l`) y validar cada binario contra referencias como GTFOBins.
* Considerar opciones como `NOEXEC` en sudoers cuando aplique (no es una bala de plata, pero reduce vectores).
* Controlar/neutralizar el uso de pagers en comandos permitidos (p.ej. variables `PAGER`, `SYSTEMD_PAGER`) según el contexto operativo.

---

## Referencias

* [GTFOBins – **less**](https://gtfobins.org/gtfobins/less/)
* [GTFOBins – **systemctl**](https://gtfobins.org/gtfobins/systemctl/)
* [Morgan (GitBook) – **Sudo systemctl privilege escalation**](https://morgan-bin-bash.gitbook.io/linux-privilege-escalation/sudo-systemctl-privilege-escalation)
* [NaryCyber – **Escalating privileges with sudo**](https://narycyber.com/posts/privilege-escalation/linux/sudo-exploitation/)
* [Medium - **Linux-based Privilege Escalation Techniques**](https://medium.com/%40ibm_ptc_security/linux-based-privilege-escalation-techniques-1e9b83269a75)